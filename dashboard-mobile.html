<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>Financial Dashboard Mobile â€” Tesseract</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap');

        :root {
            --bg-color: #050505;
            --neon-cyan: #00f3ff;
            --neon-blue: #0066ff;
            --glass-bg: rgba(0, 20, 40, 0.85);
            --text-color: #e0f7fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: var(--bg-color);
        }

        body {
            font-family: 'Orbitron', sans-serif;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            touch-action: none;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 20, 40, 0.95);
            border-bottom: 1px solid var(--neon-blue);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 1rem;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px var(--neon-cyan);
            text-align: center;
            flex: 1;
        }

        .username-display {
            font-size: 0.85rem;
            color: var(--neon-cyan);
            text-shadow: 0 0 5px var(--neon-cyan);
            padding: 5px 10px;
            background: rgba(0, 102, 255, 0.1);
            border: 1px solid rgba(0, 102, 255, 0.3);
            border-radius: 4px;
            min-width: 70px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .logout-btn {
            padding: 8px 12px;
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff3333;
            color: #ff3333;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
        }

        /* Tesseract Container */
        .tesseract-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            perspective: 1100px;
            overflow: hidden;
        }

        .tesseract {
            position: absolute;
            width: 320px;
            height: 320px;
            transform-style: preserve-3d;
            will-change: transform;
            touch-action: none;
        }

        /* Outer Cube */
        .outer-cube {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            will-change: transform;
        }

        /* Inner Cube */
        .inner-cube {
            position: absolute;
            width: 160px;
            height: 160px;
            transform-style: preserve-3d;
            will-change: transform;
            transform: translateZ(-80px);
        }

        /* Cube Faces - Outer */
        .outer-face {
            position: absolute;
            width: 320px;
            height: 320px;
            background: rgba(0, 20, 40, 0.9);
            border: 2px solid var(--neon-cyan);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow:
                0 0 30px rgba(0, 243, 255, 0.4),
                inset 0 0 60px rgba(0, 243, 255, 0.1);
            transition: transform 160ms ease, box-shadow 160ms ease, background 160ms ease;
            transform-origin: center;
            backface-visibility: hidden;
            overflow: hidden;
            -webkit-backface-visibility: hidden;
        }

        .outer-face:active {
            background: rgba(0, 30, 60, 0.95);
            box-shadow:
                0 0 40px rgba(0, 243, 255, 0.8),
                inset 0 0 80px rgba(0, 243, 255, 0.2);
            transform: translateZ(6px) scale(0.995);
        }

        .face-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            pointer-events: auto;
            /* allow icon taps */
            transform-style: preserve-3d;
            will-change: transform;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .outer-face i {
            font-size: 48px;
            color: var(--neon-cyan);
            margin-bottom: 15px;
            text-shadow: 0 0 20px var(--neon-cyan);
            filter: drop-shadow(0 0 10px rgba(0, 243, 255, 0.7));
        }

        .outer-face span {
            font-size: 14px;
            color: var(--text-color);
            text-transform: uppercase;
            letter-spacing: 2px;
            text-align: center;
            padding: 0 20px;
            font-weight: 500;
            text-shadow: 0 0 10px rgba(224, 247, 250, 0.6);
            transform: translateZ(24px);
            /* keep text above face so it's readable */
        }

        /* Cube Faces - Inner */
        .inner-face {
            position: absolute;
            width: 160px;
            height: 160px;
            background: rgba(0, 243, 255, 0.03);
            border: 1px solid rgba(0, 243, 255, 0.3);
            opacity: 0.9;
            box-shadow:
                inset 0 0 40px rgba(0, 243, 255, 0.1),
                0 0 20px rgba(0, 243, 255, 0.2);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        /* Face Positions (outer) */
        .front {
            transform: translateZ(160px);
        }

        .back {
            transform: rotateY(180deg) translateZ(160px);
        }

        .right {
            transform: rotateY(90deg) translateZ(160px);
        }

        .left {
            transform: rotateY(-90deg) translateZ(160px);
        }

        .top {
            transform: rotateX(90deg) translateZ(160px);
        }

        .bottom {
            transform: rotateX(-90deg) translateZ(160px);
        }

        /* inner face positions */
        .inner-front {
            transform: translateZ(80px);
        }

        .inner-back {
            transform: rotateY(180deg) translateZ(80px);
        }

        .inner-right {
            transform: rotateY(90deg) translateZ(80px);
        }

        .inner-left {
            transform: rotateY(-90deg) translateZ(80px);
        }

        .inner-top {
            transform: rotateX(90deg) translateZ(80px);
        }

        .inner-bottom {
            transform: rotateX(-90deg) translateZ(80px);
        }

        /* Connecting Lines for Tesseract */
        .connection {
            position: absolute;
            background: linear-gradient(to right,
                    transparent,
                    rgba(0, 243, 255, 0.45),
                    transparent);
            height: 1px;
            pointer-events: none;
            filter: blur(0.6px);
            transform-origin: center left;
            will-change: transform, width;
        }

        /* Touch Hint */
        .touch-hint {
            position: fixed;
            bottom: 30px;
            left: 0;
            right: 0;
            color: rgba(0, 243, 255, 0.8);
            font-size: 13px;
            text-align: center;
            padding: 12px;
            background: rgba(0, 20, 40, 0.5);
            border-top: 1px solid rgba(0, 243, 255, 0.3);
            backdrop-filter: blur(5px);
            z-index: 100;
        }

        /* Grid Background */
        .grid-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
            z-index: -1;
        }

        /* Active Tap Effect */
        .tap-effect {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle,
                    rgba(0, 243, 255, 0.3) 0%,
                    rgba(0, 243, 255, 0.1) 40%,
                    transparent 70%);
            pointer-events: none;
            opacity: 0;
            z-index: 500;
        }

        /* small responsiveness */
        @media (max-width:420px) {
            .tesseract {
                width: 260px;
                height: 260px;
            }

            .outer-face {
                width: 260px;
                height: 260px;
            }

            .outer-face i {
                font-size: 42px;
            }
        }
    </style>
</head>

<body>
    <!-- Grid Background -->
    <div class="grid-bg"></div>

    <!-- Header -->
    <div class="header">
        <div class="username-display" id="usernameDisplay">-</div>
        <h1>FINANCIAL ESTIMATES</h1>
        <button class="logout-btn" onclick="logout()">
            <i class="fa fa-sign-out"></i>
        </button>
    </div>

    <!-- Tesseract Container -->
    <div class="tesseract-container" id="scene">
        <div class="tesseract" id="tesseract">
            <!-- Outer Cube -->
            <div class="outer-cube" id="outerCube">
                <!-- Menu Faces -->
                <div class="outer-face front" data-target="dashboard-mobile-portfolio.html">
                    <div class="face-content">
                        <i class="fa fa-chart-pie"></i>
                        <span>Portfolio</span>
                    </div>
                </div>
                <div class="outer-face back" data-target="dashboard-mobile-trading.html">
                    <div class="face-content">
                        <i class="fa fa-rocket"></i>
                        <span>Go Live</span>
                    </div>
                </div>
                <div class="outer-face right" data-target="dashboard-mobile-news.html">
                    <div class="face-content">
                        <i class="fa fa-exchange"></i>
                        <span>News</span>
                    </div>
                </div>
                <div class="outer-face left" data-target="dashboard-mobile-account.html">
                    <div class="face-content">
                        <i class="fa fa-university"></i>
                        <span>Rapporti</span>
                    </div>
                </div>
                <div class="outer-face top" data-target="dashboard-mobile-market.html">
                    <div class="face-content">
                        <i class="fa fa-list"></i>
                        <span>Market</span>
                    </div>
                </div>
                <div class="outer-face bottom" data-target="dashboard-mobile-trend.html">
                    <div class="face-content">
                        <i class="fa fa-edit"></i>
                        <span>Trend</span>
                    </div>
                </div>
            </div>

            <!-- Inner Cube -->
            <div class="inner-cube" id="innerCube">
                <div class="inner-face inner-front"></div>
                <div class="inner-face inner-back"></div>
                <div class="inner-face inner-right"></div>
                <div class="inner-face inner-left"></div>
                <div class="inner-face inner-top"></div>
                <div class="inner-face inner-bottom"></div>
            </div>

            <!-- Connections will be created dynamically -->
            <div id="connections"></div>
        </div>
    </div>

    <!-- Touch Hint -->
    <div class="touch-hint">
        ðŸ‘† Tocca e trascina per ruotare il tesseract â€¢ Tocca una faccia per entrare
    </div>

    <script>
        // ========== CONFIGURATION ==========
        const API_URL = "https://feweb-tunnel.fe-web.eu";
        const TESSERACT_SIZE = 320; // outer cube size (px)
        const INNER_SIZE = 160; // inner cube size (px)
        const SENSITIVITY = 0.28; // slightly lower for mobile precision
        const INERTIA_DECAY = 0.93;
        const LERP = 0.12; // smoothing factor for rotation

        // ========== ELEMENTS ==========
        const tesseract = document.getElementById('tesseract');
        const outerCube = document.getElementById('outerCube');
        const innerCube = document.getElementById('innerCube');
        const connections = document.getElementById('connections');
        const scene = document.getElementById('scene');
        const usernameDisplay = document.getElementById('usernameDisplay');

        // ========== STATE ==========
        let rotation = { x: -15, y: 15, z: 0 };
        let targetRotation = { x: rotation.x, y: rotation.y, z: rotation.z };
        let velocity = { x: 0, y: 0 };
        let isDragging = false;
        let lastTouch = { x: 0, y: 0 };
        let lastTime = 0;
        let animationId = null;
        let isAnimating = true;

        let credentials = {
            username: '',
            token: '',
            language: '',
            filter: ''
        };

        // ========== TESSERACT CONNECTIONS ==========
        function createConnections() {
            connections.innerHTML = '';

            // Outer cube vertices (normalized)
            const half = 1;
            const outerVertices = [
                { x: -half, y: -half, z: -half }, { x: half, y: -half, z: -half },
                { x: half, y: half, z: -half }, { x: -half, y: half, z: -half },
                { x: -half, y: -half, z: half }, { x: half, y: -half, z: half },
                { x: half, y: half, z: half }, { x: -half, y: half, z: half }
            ];

            // Inner cube vertices (scaled by 0.5)
            const innerVertices = outerVertices.map(v => ({ x: v.x * 0.5, y: v.y * 0.5, z: v.z * 0.5 }));

            // Connect matching outer->inner
            for (let i = 0; i < 8; i++) createConnection(outerVertices[i], innerVertices[i]);

            const cubeEdges = [
                [0, 1], [1, 2], [2, 3], [3, 0],
                [4, 5], [5, 6], [6, 7], [7, 4],
                [0, 4], [1, 5], [2, 6], [3, 7]
            ];

            cubeEdges.forEach(e => createConnection(outerVertices[e[0]], outerVertices[e[1]], true));
            cubeEdges.forEach(e => createConnection(innerVertices[e[0]], innerVertices[e[1]], true));
        }

        function createConnection(a, b, isEdge = false) {
            const el = document.createElement('div');
            el.className = 'connection';

            const mid = { x: (a.x + b.x) / 2, y: (a.y + b.y) / 2, z: (a.z + b.z) / 2 };
            const dx = b.x - a.x, dy = b.y - a.y, dz = b.z - a.z;
            const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);
            const length = dist * TESSERACT_SIZE;

            const yaw = Math.atan2(dx, dz) * 180 / Math.PI;
            const pitch = Math.atan2(dy, Math.sqrt(dx * dx + dz * dz)) * 180 / Math.PI;

            el.style.width = length + 'px';
            el.style.height = (isEdge ? '1px' : '0.6px');
            el.style.transform = `translate3d(${mid.x * TESSERACT_SIZE / 2}px, ${mid.y * TESSERACT_SIZE / 2}px, ${mid.z * TESSERACT_SIZE / 2}px) rotateY(${yaw}deg) rotateX(${-pitch}deg)`;

            connections.appendChild(el);
        }

        // ========== ANIMATION LOOP ==========
        function animate(ts) {
            if (!lastTime) lastTime = ts;
            const dt = Math.min(ts - lastTime, 40) / 16;
            lastTime = ts;

            // if dragging, targetRotation follows immediate input; otherwise velocity applies to target
            if (!isDragging) {
                targetRotation.y += velocity.x * dt;
                targetRotation.x += velocity.y * dt;

                // decay velocity
                velocity.x *= INERTIA_DECAY;
                velocity.y *= INERTIA_DECAY;
                if (Math.abs(velocity.x) < 0.01) velocity.x = 0;
                if (Math.abs(velocity.y) < 0.01) velocity.y = 0;
            }

            // lerp rotation towards target for smoothness
            rotation.x += (targetRotation.x - rotation.x) * LERP;
            rotation.y += (targetRotation.y - rotation.y) * LERP;
            rotation.z += (targetRotation.z - rotation.z) * LERP;

            applyTransforms();

            if (isAnimating) animationId = requestAnimationFrame(animate);
        }

        function applyTransforms() {
            // rotate outer tesseract
            tesseract.style.transform = `rotateX(${rotation.x}deg) rotateY(${rotation.y}deg) rotateZ(${rotation.z}deg)`;

            // inner cube rotates differently -> simulate a 4D fold by offsetting and rotating with different multipliers
            innerCube.style.transform = `translateZ(-80px) rotateX(${rotation.x * -0.55}deg) rotateY(${rotation.y * -0.5}deg) rotateZ(${rotation.z * 0.35}deg)`;
        }

        // ========== TOUCH & MOUSE CONTROLS ==========
        function onPointerDown(e) {
            isDragging = true;
            const p = e.touches ? e.touches[0] : e;
            lastTouch.x = p.clientX; lastTouch.y = p.clientY;
            velocity.x = velocity.y = 0;
            // stop any snapping
        }

        function onPointerMove(e) {
            if (!isDragging) return;
            const p = e.touches ? e.touches[0] : e;
            const dx = p.clientX - lastTouch.x;
            const dy = p.clientY - lastTouch.y;

            targetRotation.y += dx * SENSITIVITY;
            targetRotation.x -= dy * SENSITIVITY;

            // store velocity for inertia
            velocity.x = dx * SENSITIVITY * 0.6;
            velocity.y = -dy * SENSITIVITY * 0.6;

            lastTouch.x = p.clientX; lastTouch.y = p.clientY;

            applyTransforms();
        }

        function onPointerUp() {
            isDragging = false;
        }

        // ========== TAP EFFECT ==========
        function createTapEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'tap-effect';
            effect.style.left = (x - 50) + 'px';
            effect.style.top = (y - 50) + 'px';

            document.body.appendChild(effect);

            effect.animate([
                { opacity: 0.8, transform: 'scale(0.5)' },
                { opacity: 0, transform: 'scale(2)' }
            ], { duration: 600, easing: 'ease-out' }).onfinish = () => effect.remove();
        }

        // ========== NAVIGATION (faces keep icons/text readable) ==========
        function navigateTo(page) {
            createTapEffect(window.innerWidth / 2, window.innerHeight / 2);
            setTimeout(() => window.location.href = page, 160);
        }

        // ========== AUTH FUNCTIONS ==========
        function loadCredentials() {
            credentials.username = localStorage.getItem("username") || '';
            credentials.token = localStorage.getItem("token") || '';
            credentials.language = localStorage.getItem("language") || 'it_IT';
            credentials.filter = localStorage.getItem("filter") || '';

            usernameDisplay.textContent = credentials.username || '-';
            if (!credentials.username) setTimeout(() => window.location.href = 'login.html', 1400);
        }

        async function logout() {
            try {
                const payload = { username: credentials.username || "", token: credentials.token || "", language: credentials.language || "", filter: credentials.filter || "" };
                await fetch(`${API_URL}/logout`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            } catch (err) { console.error('Logout error', err); }
            finally { localStorage.clear(); sessionStorage.clear(); window.location.href = 'login.html'; }
        }

        // ========== INITIALIZATION ==========
        function init() {
            loadCredentials();
            createConnections();

            isAnimating = true;
            animationId = requestAnimationFrame(animate);

            // unified pointer events (works for mouse and touch)
            scene.addEventListener('touchstart', onPointerDown, { passive: false });
            scene.addEventListener('touchmove', onPointerMove, { passive: false });
            scene.addEventListener('touchend', onPointerUp);
            scene.addEventListener('mousedown', onPointerDown);
            window.addEventListener('mousemove', onPointerMove);
            window.addEventListener('mouseup', onPointerUp);

            // add tap feedback and navigation on faces
            document.querySelectorAll('.outer-face').forEach(face => {
                face.addEventListener('touchstart', (ev) => {
                    const t = ev.touches[0]; createTapEffect(t.clientX, t.clientY);
                }, { passive: true });

                face.addEventListener('click', (ev) => {
                    const target = face.getAttribute('data-target');
                    if (target) navigateTo(target);
                });
            });

            // visibility handling
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) { isAnimating = false; cancelAnimationFrame(animationId); }
                else { isAnimating = true; lastTime = 0; animationId = requestAnimationFrame(animate); }
            });

            // prevent default context menu on long press
            document.addEventListener('contextmenu', e => e.preventDefault());
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>